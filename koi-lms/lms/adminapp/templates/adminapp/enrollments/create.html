{% extends 'adminapp/base.html' %}
{% load static %}

{% block title %}New Enrollment - KOI LMS{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">
                        <i class="fas fa-plus-circle"></i> Create New Enrollment
                    </h4>
                </div>
                <div class="card-body">
                    <form method="post" id="enrollmentForm">
                        {% csrf_token %}

                        
                        <!-- Student Selection -->
                        <div class="mb-4">
                            <label class="form-label fw-bold">Select Student *</label>
                                                     {{ form.student }}

                            <small class="text-muted">Search by student name or ID</small>
                        </div>

                        <!-- Course Selection -->
                        <div class="mb-4">
                            <label class="form-label fw-bold">Select Course *</label>
                                                    {{ form.course }}

                            <div id="courseInfo" class="mt-2"></div>
                        </div>

                        <!-- Enrollment Details -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <label class="form-label fw-bold">Enrollment ID *</label>
                                <input type="text" name="enrollment_id" class="form-control" 
                                       placeholder="E.g., ENR001" required>
                                <small class="text-muted">Unique enrollment identifier</small>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-bold">Enrollment Date *</label>
                                <input type="date" name="enrollment_date" class="form-control" 
                                       value="{{ today }}" required>
                            </div>
                        </div>

                        <!-- Status and Role -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <label class="form-label fw-bold">Status *</label>
                                <select name="status" class="form-select" required>
                                    <option value="Enrolled" selected>Enrolled</option>
                                    <option value="Pending">Pending</option>
                                    <option value="Waitlisted">Waitlisted</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-bold">Role</label>
                                <select name="role" class="form-select">
                                    <option value="Student" selected>Student</option>
                                    <option value="Auditor">Auditor</option>
                                </select>
                            </div>
                        </div>

                        <!-- Notes -->
                        <div class="mb-4">
                            <label class="form-label fw-bold">Notes (Optional)</label>
                            <textarea name="notes" class="form-control" rows="3" 
                                      placeholder="Add any additional notes..."></textarea>
                        </div>

                        <!-- Submit Buttons -->
                        <div class="d-flex justify-content-between">
                            <a href="{% url 'enrollment_list' %}" class="btn btn-secondary">
                                <i class="fas fa-arrow-left"></i> Cancel
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Create Enrollment
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Preview Card -->
            <div class="card mt-4" id="previewCard" style="display: none;">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0"><i class="fas fa-eye"></i> Enrollment Preview</h5>
                </div>
                <div class="card-body">
                    <div id="previewContent"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.getElementById('courseSelect').addEventListener('change', function() {
    const option = this.options[this.selectedIndex];
    const courseInfo = document.getElementById('courseInfo');
    
    if (this.value) {
        courseInfo.innerHTML = `
            <div class="alert alert-info">
                <strong>Course Details:</strong><br>
                Code: ${option.dataset.courseCode}<br>
                Credits: ${option.dataset.credits}<br>
                Instructor: ${option.dataset.instructor}
            </div>
        `;
    } else {
        courseInfo.innerHTML = '';
    }
});

// Real-time preview
document.getElementById('enrollmentForm').addEventListener('input', function() {
    const studentSelect = document.getElementById('studentSelect');
    const courseSelect = document.getElementById('courseSelect');
    const previewCard = document.getElementById('previewCard');
    const previewContent = document.getElementById('previewContent');
    
    if (studentSelect.value && courseSelect.value) {
        const studentText = studentSelect.options[studentSelect.selectedIndex].text;
        const courseText = courseSelect.options[courseSelect.selectedIndex].text;
        
        previewCard.style.display = 'block';
        previewContent.innerHTML = `
            <p><strong>Student:</strong> ${studentText}</p>
            <p><strong>Course:</strong> ${courseText}</p>
            <p><strong>Status:</strong> ${document.querySelector('[name="status"]').value}</p>
        `;
    } else {
        previewCard.style.display = 'none';
    }
});
</script>
{% endblock %}
